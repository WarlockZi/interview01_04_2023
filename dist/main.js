(()=>{"use strict";const e=function(e){return String(e).toLowerCase().match(/^[\w]{1}[\w-\.]*@[\w-]+\.[a-z]{2,4}$/i)??null},t=function(e){let t=[];return e.length<6&&t.push("Длина пароля должна быть длиннее 6 символов"),e.match("[0-9]")||t.push("Пароль должен содержать цифры"),t};async function n(e,t,n="POST"){return new Promise((async function(s,o){let r=new XMLHttpRequest;r.open(n,e,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?r.send(t):(r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send("param="+JSON.stringify(t))),r.onerror=function(e){o(Error("Network Error"+e.message))},r.onload=function(){const e=JSON.parse(r.response);s(e)}}))}!function(){let e=document.querySelector(".task-wrap");if(e){let s={newTask:e.querySelector(".new-task"),newTaskBtn:e.querySelector(".new-task button"),newTaskInput:e.querySelector(".new-task input"),tasks:document.querySelector(".tasks")};e.addEventListener("click",(function({target:e}){e.classList.contains("del")?async function(e){let t=e.closest(".row"),s=t.id,o={id:s},r=await n("/task/"+s,o,"DELETE");"ok"===r[0]&&(alert(r[1]),t.remove())}(e):e.classList.contains("edit")?async function(e){let t=e.closest(".row"),s=(t.querySelector(".text"),t.id),o={id:s},r=await n("/task/"+s,o,"PUT");"ok"===r[0]&&(alert(r[1]),t.remove())}(e):e===s.newTaskBtn&&t.apply(s)}))}async function t(){let e=this.newTaskInput.value,t={todo:e},s=await n("/task",t,"POST");"ok"===s[0]&&(function(e,t,n){let s=document.createElement("div");s.classList.add("row"),s.id=t;let o=document.createElement("div");o.classList.add("todo"),o.innerText=e;let r=document.createElement("div");r.classList.add("buttons");let a=document.createElement("div");a.classList.add("del"),a.innerText="X";let i=document.createElement("div");i.classList.add("edit"),i.innerText="Редакт-ть",r.append(a),r.append(i),s.append(o),s.append(r),n.append(s)}(e,s[1],this.tasks),this.newTaskInput.value="")}}(),function(){if(document.querySelector("form")){let o={container:document.querySelector("#container"),loginBtn:document.querySelector("#login-button"),closeBtn:document.querySelector(".close-btn"),submitBtn:document.querySelector("[type='submit']"),email:document.querySelector("[name='email']"),password:document.querySelector("[name='password']"),error:document.querySelector("#error")};o.loginBtn&&(o.loginBtn.onclick=function(){this.loginBtn.classList.add("hide"),this.container.classList.add("show")}.bind(o)),o.closeBtn.onclick=function(){this.loginBtn.classList.remove("hide"),this.container.classList.remove("show")}.bind(o),o.submitBtn.onclick=async function(o){if(o.preventDefault(),!e(this.email.value))return this.email.style.border="1px solid red",!1;let r=t(this.password.value);if(r.length)return this.password.style.border="1px solid red",s(r,this),!1;{let e=new FormData;e.append("email",this.email.value),e.append("password",this.password.value);let t=o.target.getAttribute("data-action"),r=await n(`/auth/${t}`,e);"ok"===r[0]?window.location.href="/task":s(r,this)}}.bind(o)}function s(e,t){t.error.childNodes.length&&(t.error.innerHTML=""),e.forEach((e=>{let n=document.createElement("div");n.innerText=" - "+e,t.error.append(n)})),t.error.style.display="flex"}}()})();