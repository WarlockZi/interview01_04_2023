(()=>{"use strict";const e=function(e){return String(e).toLowerCase().match(/^[\w]{1}[\w-\.]*@[\w-]+\.[a-z]{2,4}$/i)??null},t=function(e){let t=[];return e.length<6&&t.push("Длина пароля должна быть длиннее 6 символов"),e.match("[0-9]")||t.push("Пароль должен содержать цифры"),t};async function n(e,t,n="POST"){return new Promise((async function(r,o){let a=new XMLHttpRequest;a.open(n,e,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),t instanceof FormData?a.send(t):(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send("param="+JSON.stringify(t))),a.onerror=function(e){o(Error("Network Error"+e.message))},a.onload=function(){const e=JSON.parse(a.response);r(e)}}))}function r(e,t=null,n,r=null,o=null,a=null){let l=document.createElement(e);return t&&l.classList.add(t),n&&(l.id=n),r&&(l.innerText=r),o&&l.setAttribute("type",o),a&&l.setAttribute("checked",!0),l}class o{DTO(e){return{id:e.id,text:e.querySelector(".todo").innerText,important:e.querySelector(".important").innerText,date:e.querySelector(".date").innerText}}}function a(e,t){for(var n=[],r=0,o=e.length;r<o;r++)n.push(e[r].substr(0,t));return n}var l=function(e){return function(t,n){var r=n[e].map((function(e){return e.toLowerCase()})),o=r.indexOf(t.toLowerCase());return o>-1?o:null}};var s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=["January","February","March","April","May","June","July","August","September","October","November","December"],u=a(i,3);!function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,o=t;r<o.length;r++){var a=o[r];for(var l in a)e[l]=a[l]}}({},{dayNamesShort:a(s,3),dayNames:s,monthNamesShort:u,monthNames:i,amPm:["am","pm"],DoFn:function(e){return e+["th","st","nd","rd"][e%10>3?0:(e-e%10!=10?1:0)*e%10]}});l("monthNamesShort"),l("monthNames");class c{constructor(e){let t=e.date;this.id=e.id??null,this.todo=e.todo??null,this.date=t??null,this.check=+e.check??null}}class d extends o{constructor(e){super(),this.todoEl=e.querySelector("input[type='text']"),this.todo=this.todoEl.value,this.dateEl=e.querySelector("input[type='date']"),this.date=this.dateEl.value,this.checkEl=e.querySelector("input[type='checkbox']"),this.check=this.checkEl.checked,this.addBtn=e.querySelector("button"),this.tasks=e.closest(".task-wrap").querySelector(".tasks")}async save(){if(!this.todo||!this.date)return!1;let e=new c(this),t=await n("/tasks",e,"POST");return"ok"===t[0]?t[1]:void 0}render(e){let t=r("div","row",e),n=r("div","todo",null,this.todo),o=r("div","date",null,this.date),a=r("div","important",null,"!"),l=r("div","buttons"),s=r("div","del",null,"X"),i=r("div","edit",null,"Редакт-ть");l.append(s),l.append(i),t.append(a),t.append(o),t.append(n),t.append(l),this.tasks.append(t)}clear(){this.checkEl.checked=!1,this.dateEl.value="",this.todoEl.value=""}}!function(){let e=document.querySelector(".task-wrap");if(e){let t={newTask:e.querySelector(".new-task"),newTaskBtn:e.querySelector(".new-task button"),newTaskInput:e.querySelector(".new-task input[type='text']"),newTaskDate:e.querySelector(".new-task input[type='date']"),newTaskCheck:e.querySelector(".new-task input[type='checkbox']"),tasks:document.querySelector(".tasks")};e.addEventListener("click",(function({target:e}){e.classList.contains("del")?async function(e){let t=e.closest(".row"),r=t.id,o={id:r},a=await n("/tasks/"+r,o,"DELETE");"ok"===a[0]&&(alert(a[1]),t.remove())}(e):e.classList.contains("edit")?async function(e){!function(e){let t=document.querySelector(".popup");t&&t.remove();let n=document.querySelector("body"),o=r("div","overlay"),a=r("div","popup"),l=r("div","close",null,"X"),s=r("button",null,null,"Сохранить","submit");o.append(a),a.append(l),a.append(e),a.append(s),n.append(o),l.addEventListener("click",(function(e){e.target.closest(".overlay").remove()})),o.addEventListener("click",(function({target:e}){e.classList.contains("overlay")&&e.remove()}))}(function(e){let t=r("div","content",e.id),n=r("input","todo",null,null,"text");n.value=e.todo;let o=r("labbel",null,null,"Задача"),a=r("input","date",null,e.date,"date");a.value=e.date;let l=r("labbel",null,null,"Дата"),s=r("input","important",null,"!","checkbox");s.checked=!!e.important;let i=r("labbel",null,null,"Важная");return t.append(o),t.append(n),t.append(l),t.append(a),t.append(i),t.append(s),t}(function(e){return{id:e.id,todo:e.querySelector(".todo").innerText,important:e.querySelector(".important").innerText,date:e.querySelector(".date").innerText}}(e.closest(".row"))))}(e):e===t.newTaskBtn&&async function(e){let t=e.closest(".new-task"),n=new d(t),r=await n.save();r&&(n.render(r),n.clear())}(e)}))}}(),function(){if(document.querySelector("form")){let o={container:document.querySelector("#container"),loginBtn:document.querySelector("#login-button"),closeBtn:document.querySelector(".close-btn"),submitBtn:document.querySelector("[type='submit']"),email:document.querySelector("[name='email']"),password:document.querySelector("[name='password']"),error:document.querySelector("#error")};o.loginBtn&&(o.loginBtn.onclick=function(){this.loginBtn.classList.add("hide"),this.container.classList.add("show")}.bind(o)),o.closeBtn.onclick=function(){this.loginBtn.classList.remove("hide"),this.container.classList.remove("show")}.bind(o),o.submitBtn.onclick=async function(o){if(o.preventDefault(),!e(this.email.value))return this.email.style.border="1px solid red",!1;let a=t(this.password.value);if(a.length)return this.password.style.border="1px solid red",r(a,this),!1;{let e=new FormData;e.append("email",this.email.value),e.append("password",this.password.value);let t=o.target.getAttribute("data-action"),a=await n(`/auth/${t}`,e);"ok"===a[0]?window.location.href="/tasks":r(a,this)}}.bind(o)}function r(e,t){t.error.childNodes.length&&(t.error.innerHTML=""),e.forEach((e=>{let n=document.createElement("div");n.innerText=" - "+e,t.error.append(n)})),t.error.style.display="flex"}}()})();